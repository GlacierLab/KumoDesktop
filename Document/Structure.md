# 云酱桌面端技术架构
## 执行逻辑
云酱桌面端使用WPF+WebView2开发，除启动窗口外所有界面均使用WebView2渲染，逻辑跑在C#层上  
云酱每个实例都要求指定一个启动资源包，将该资源包加载到映射的域名上，然后加载首页内容  
## 资源包格式
资源包使用ZIP压缩，内含`manifest.json`描述资源包信息，可选使用`icon.png`作为图标，分为主资源包和叠加资源包  
主资源包内为WebView2执行所需文件，类似于网站资源结构  
叠加资源包会安装到指定的主资源包目录，主要用于独立于主资源包动态更新的一些数据  
主程序仓库内除了一个示例包以外不包含任何资源包，官方资源包均使用独立仓库托管，这有助于解耦合  
#### 资源包类型
核心资源包：`CorePkg`开头，包括云酱桌面端启动时必须依赖的功能包，若本地不存在会在启动时全部安装  
扩展资源包：`DynamicPkg`开头，包括云酱桌面端动态下发的功能扩展，依托运行时能力，在触发需求时下载安装  
原生扩展：`NativeExt`开头，包括云酱桌面端动态下发的原生扩展，实现运行时能力以外的功能
## 权限管理
对于不受信任的扩展包，云酱默认限制所有权限，仅允许读取包体内资源和访问网络  
在首次请求需要扩展权限的操作时，云酱会弹出授权提示，用户可选择允许/仅本次允许/拒绝  
可授权的权限及最低需求运行时版本号如下：  
`ReadFile`读取文件-100  
`WriteFile`写入文件-100  
`Execute`执行文件-100  
`Register`编辑注册表-100  
`Firewall`编辑防火墙-100  
## 开发原则
作为帮助游戏玩家的工具，考虑到游戏是资源密集型程序，云酱必须尽可能占用最小资源以腾出更多资源留给游戏  
因此云酱的资源包开发原则如下：  
1. 视觉效果一切从简，不使用包括阴影圆角变形半透明模糊等一切消耗GPU资源的效果  
2. 不使用任何过渡动画，图片资源尽可能使用矢量图  
3. 尽可能随用随加载，不使用的资源激进释放  
4. 随时保存用户状态信息，以允许内存不足时直接释放进程  
